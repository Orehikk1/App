// âœ… ÐšÑƒÑ€Ñ Ð²Ð°Ð»ÑŽÑ‚ Ñ ÑÑ„Ñ„ÐµÐºÑ‚Ð¾Ð¼ Ð°ÐºÑÐµÐ»ÐµÑ€Ð¾Ð¼ÐµÑ‚Ñ€Ð° (Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾!)
struct ExchangeRateView: View {
    @ObservedObject var viewModel: CardViewModel
    @State private var xOffset: CGFloat = 0
    @State private var yOffset: CGFloat = 0
    private let motionManager = CMMotionManager()

    var body: some View {
        VStack {
            if let rate = viewModel.euroToHufRate {
                VStack(alignment: .center, spacing: 8) {
                    Text("ðŸ’± Exchange Rate")
                        .font(.headline)
                        .foregroundColor(.black.opacity(0.8))
                    
                    Text("1 EUR = \(rate, specifier: "%.2f") HUF")
                        .font(.largeTitle.bold())
                        .foregroundColor(.black)
                        .padding(.vertical, 5)
                    
                    Text("Updated live")
                        .font(.caption)
                        .foregroundColor(.black.opacity(0.6))
                }
                .padding()
                .background(
                    RoundedRectangle(cornerRadius: 20)
                        .fill(Color.white)
                        .shadow(color: .black.opacity(0.2), radius: 10)
                )
                .offset(x: xOffset, y: yOffset) // ðŸ“Œ Ð ÐµÐ°ÐºÑ†Ð¸Ñ Ð½Ð° Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ
                .animation(.spring(response: 0.5, dampingFraction: 0.6), value: xOffset)
                .onAppear {
                    startMotionUpdates()
                }
            } else {
                Text("Loading exchange rate EUR â†’ HUF...")
                    .foregroundColor(.gray)
                    .font(.headline)
                    .padding()
            }
        }
    }
    
    // âœ… Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð°ÐºÑÐµÐ»ÐµÑ€Ð¾Ð¼ÐµÑ‚Ñ€ (Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼ Ñ†ÐµÐ½Ñ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼)
    private func startMotionUpdates() {
        if motionManager.isAccelerometerAvailable {
            motionManager.accelerometerUpdateInterval = 0.1
            motionManager.startAccelerometerUpdates(to: .main) { data, error in
                guard let data = data, error == nil else { return }

                withAnimation(.easeOut(duration: 0.3)) {
                    let threshold: CGFloat = 0.05 // ðŸ”¹ Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ñ€ÐµÐ·ÐºÐ¸Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ
                    
                    // ðŸ“Œ Ð•ÑÐ»Ð¸ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ Ð›Ð•Ð–Ð˜Ð¢ (y â‰ˆ 1.0) â†’ Ð¡Ñ‚Ð°Ð²Ð¸Ð¼ Ð¸ÐºÐ¾Ð½ÐºÑƒ ÐŸÐž Ð¦Ð•ÐÐ¢Ð Ð£
                    if abs(data.acceleration.y) > 0.95 {
                        xOffset = 0
                        yOffset = 0
                    } 
                    // ðŸ“Œ Ð•ÑÐ»Ð¸ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ Ð’Ð•Ð Ð¢Ð˜ÐšÐÐ›Ð¬ÐÐž (y â‰ˆ 0.0) â†’ Ð¦ÐµÐ½Ñ‚Ñ€Ð¸Ñ€ÑƒÐµÐ¼ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
                    else {
                        let newX = CGFloat(data.acceleration.y) * 10 // Ð£Ð¼ÐµÐ½ÑŒÑˆÐ°ÐµÐ¼ ÑÐ´Ð²Ð¸Ð³
                        let newY = CGFloat(data.acceleration.x) * -10 // Ð˜Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ X

                        // ðŸ“Œ Ð”ÐµÐ»Ð°ÐµÐ¼ Ð¿Ð»Ð°Ð²Ð½ÑƒÑŽ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÑƒ
                        if abs(newX) > threshold { xOffset = newX }
                        if abs(newY) > threshold { yOffset = newY }
                    }
                }
            }
        }
    }
}
